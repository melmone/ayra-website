<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ご購入手続き | Ayra</title>
  <link rel="stylesheet" href="stylesheet.css">
</head>

<body>

  <h2>ご購入手続き</h2>

  <form class="checkout-form" id="checkout-form">
    <label for="checkout-email" class="checkout-label">メールアドレス:</label><br>
      <input type="email" name="email" class="checkout-input" required>
    <br><br>

    <label for="checkout-address" class="checkout-label">お届け先住所:</label><br>
      <textarea id="checkout-address" name="address" class="checkout-textarea" rows="4" required></textarea>
    <br><br>
  </form>

  <h3>お支払い</h3>
  <!-- ▼ここにPayPalのコードを貼り付け▼ -->
  <div id="paypal-button-container"></div>
  
  <br>
  <button class="back-button" onclick="history.back()">← カートに戻る</button>

  <script src="https://www.paypal.com/sdk/js?client-id=AT8cSY5uNZPTDuIEpFSCkQ4_mIFeEU30WAuXl9wK64vIodxOA9R2EXBatYNxt50vKM76XRE_TFztEnH0&currency=JPY"></script>
  
  <script>
    const cart = JSON.parse(localStorage.getItem('cart')) || [];
    const total = cart.reduce((sum, item) => sum + item.price, 0); // item.price に価格が入ってる前提
  
    paypal.Buttons({
      createOrder: function(data, actions) {
        return actions.order.create({
          purchase_units: [{
            amount: {
              value: total.toString()
            }
          }]
        });
      },
      onApprove: function(data, actions) {
        return actions.order.capture().then(function(details) {
          alert('決済が完了しました。ありがとうございます！');
          localStorage.removeItem('cart');
          location.reload();
        });
      }
    }).render('#paypal-button-container');
  </script>
  
  <script>
  import { getFirestore, doc, updateDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const db = getFirestore();
const productId = "ring1-1"; // 対象の商品ID

await updateDoc(doc(db, "products", productId), {
  isSoldOut: true
});

</script>



</body>
</html>
